{% extends ':site:base.html.twig' %}
{% block title %}Ordenes de compra{% endblock %}
{% block body %}
  <div class="d-flex flex-column p-2 pl-lg-5 pr-lg-5 pt-lg-3 pb-lg-3">
    <span class="conceptos-title-strong mt-2 mb-2">ORDENES DE COMPRA</span>
    <div class="d-flex flex-wrap">
      {% for externalRequest in externalRequests|reverse %}
        {% set productCount = 0 %}
        {% for product in externalRequest.externalRequestProducts %}
          {% set productCount = productCount + product.count %}
        {% endfor %}
        <div class="external-request col-12 col-lg-3 p-2" data-id="{{externalRequest.id}}" style="display: none;"
             data-remaining-days="{{externalRequest.remainingTimeFromCreation|date('%d')}}"
             data-remaining-hours="{{externalRequest.remainingTimeFromCreation|date('%h')}}"
             data-remaining-minutes="{{externalRequest.remainingTimeFromCreation|date('%i')}}"
             data-remaining-seconds="{{externalRequest.remainingTimeFromCreation|date('%s')}}">
          <div class="d-flex flex-column conceptos-white-background external-request-card w-100 p-2">
            <div class="d-flex justify-content-between align-items-start">
              <div class="d-flex flex-column pl-0">
                <span class="conceptos-title-strong mt-1">Pedido: {{externalRequest.id}}</span>
                <span class="conceptos-product-info mt-1">Precio IKEA: ${{externalRequest.finalPrice}}</span>
                <span class="conceptos-product-info mt-1">Taxes: ${{externalRequest.finalPrice * 0.07}}</span>
                <span class="conceptos-product-info mt-1">Peso: {{externalRequest.weight}} Kg</span>
                <span class="conceptos-product-info mt-1">Cant. productos: {{productCount}}</span>
                <span class="conceptos-product-info mt-1">Costos extra: ${{externalRequest.budget}}</span>
                <span class="conceptos-product-info mt-1">Precio del pasaje: ${{externalRequest.ticketPrice}}</span>
                <span class="conceptos-product-info mt-1">Ganancia para el proveedor: ${{externalRequest.providerProfit}}</span>
                <span class="conceptos-product-info mt-1">Pago total: ${{externalRequest.payment}}</span>
                <span class="conceptos-product-info mt-1">Fecha de entrega: {{externalRequest.date|date('d/m/Y')}}</span>
                <span class="conceptos-product-info mt-1">Precio de venta: ${{externalRequest.sellPrice}}</span>
                <span class="conceptos-product-info remaining-time mt-1"></span>
              </div>
              <a class="print-external-request" href="{{path('export_external_request', {id: externalRequest.id})}}">
                <div class="d-flex flex-column">
                  <img class="conceptos-image mt-1" src="{{ asset('bundles/conceptos/images/home/external-request.png') }}">
                  <div class="d-flex justify-content-between m-1">
                    <i class="fa fa-file-pdf-o conceptos-black-icon"></i>
                    <span class="conceptos-subtitle">Pedido {{externalRequest.id}}</span>
                    <i class="fa fa-download conceptos-black-icon"></i>
                  </div>
                </div>
              </a>
            </div>
            <a class="conceptos-primary-button mt-2" data-toggle="modal" data-target="#external-request-product-modal-{{loop.index}}">VISTA PREVIA</a>
            <a class="conceptos-primary-button accept-external-request-button mt-1" data-path="{{path('accept_external_request', {id: externalRequest.id})}}">ACEPTAR</a>
          </div>
          <div id="external-request-product-modal-{{loop.index}}" class="modal fade">
            <div class="modal-dialog modal-lg">
              <div class="modal-content">
                <div class="modal-body conceptos-gray-background">
                  <button class="close-external-request-modal lateral_menu__close" data-dismiss="modal"></button>
                  <div class="d-flex flex-wrap mt-3">
                    {% set sizes = '(min-width: 1000px) 12vw, 45vw' %}
                    {% for externalRequestProduct in externalRequest.externalRequestProducts %}
                      {% set product = externalRequestProduct.product %}
                      {% set isExternalRequestProduct = true %}
                      <div class="d-flex col-6 col-lg-3 pl-0">
                        {{ include('site/product-summary-short.html.twig') }}
                      </div>
                    {% endfor %}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      {% else %}
        <div class="d-flex justify-content-center w-100">
          <span class="conceptos-subtitle mt-2 mb-2">No existen ordenes de compra</span>
        </div>
      {% endfor %}
    </div>
  </div>
{% endblock %}
{% block js %}
  <script src="{{ asset('bundles/conceptos/scripts/js/external-request.js') }}"></script>
{% endblock %}
